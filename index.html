<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Image Downloader</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      background: #f0f0f0;
    }
    h1 {
      margin-bottom: 20px;
    }
    input, button {
      padding: 10px;
      width: 100%;
      max-width: 400px;
      margin-bottom: 10px;
      font-size: 16px;
    }
    #status {
      margin-top: 20px;
      white-space: pre-line;
      background: #fff;
      padding: 15px;
      border-radius: 5px;
      max-width: 600px;
    }
  </style>
</head>
<body>
  <h1>Image Downloader</h1>
  <input type="text" id="url" placeholder="Paste waifubitches.com gallery URL"><br>
  <input type="number" id="count" placeholder="Enter image count manually"><br>
  <button onclick="startDownload()">Start Download</button>
  <div id="status">Status: Waiting for input...</div>

  <script>
    function startDownload() {
      const url = document.getElementById('url').value.trim();
      const count = parseInt(document.getElementById('count').value.trim(), 10);
      const statusDiv = document.getElementById('status');

      if (!url) {
        statusDiv.textContent = "‚ùå Please enter a gallery URL.";
        return;
      }

      if (isNaN(count) || count <= 0) {
        statusDiv.textContent = "‚ùå Please enter a valid image count.";
        return;
      }

      statusDiv.textContent = "üîç Starting download...";

      const baseURL = location.hostname === 'localhost'
        ? 'http://127.0.0.1:5000'
        : 'https://wb-3.onrender.com';

      fetch(`${baseURL}/download`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ url, count })
      })
      .then(async (res) => {
        const text = await res.text();
        try {
          const json = JSON.parse(text);
          if (json.success) {
            statusDiv.innerHTML = `
‚úÖ Downloaded: ${json.downloaded} images<br>
‚ùå Failed: ${json.failed}<br>
üìÅ Folder: ${json.folder}<br>
üì¶ <a href="${baseURL}${json.zip_url}" download>Click here to download ZIP</a>`;
          } else {
            statusDiv.textContent = `‚ùå Error: ${json.error}`;
          }
        } catch (e) {
          statusDiv.textContent = `‚ùå Server sent non-JSON response:\n\n${text.substring(0, 300)}...`;
        }
      })
      .catch(err => {
        statusDiv.textContent = "‚ùå Network or server error: " + err.message;
      });
    }
  </script>
</body>
</html>
